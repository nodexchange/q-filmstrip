ADTECHDefine(function(){var VIDEO_FIRST_QUARTILE="firstQuartile",VIDEO_MIDPOINT="midpoint",VIDEO_THIRD_QUARTILE="thirdQuartile",QUARTILE_LOGGING_ORDER=[VIDEO_FIRST_QUARTILE,VIDEO_MIDPOINT,VIDEO_THIRD_QUARTILE],VIDEO_RESUME="resume",VIDEO_MUTE="mute",VIDEO_BUFFERING_EVENT="buffering",VIDEO_BUFFERING_END_EVENT="bufferingEnd",VIDEO_UNMUTE="unmute",VIDEO_FULLSCREEN="fullscreen",VIDEO_EXITFULLSCREEN="exitfullscreen",VIDEO_EVENTS={play:"Video Start",playButton:"Video Play",pause:"Video Pause",ended:"Video Complete",seeked:"Video Seek",replay:"Video Replay"};VIDEO_EVENTS[VIDEO_FIRST_QUARTILE]="Video First Quartile",VIDEO_EVENTS[VIDEO_MIDPOINT]="Video Midpoint",VIDEO_EVENTS[VIDEO_THIRD_QUARTILE]="Video Third Quartile",VIDEO_EVENTS[VIDEO_RESUME]="Video Resume",VIDEO_EVENTS[VIDEO_MUTE]="Video Mute",VIDEO_EVENTS[VIDEO_UNMUTE]="Video Unmute",VIDEO_EVENTS[VIDEO_BUFFERING_EVENT]="Video Buffering",VIDEO_EVENTS[VIDEO_BUFFERING_END_EVENT]="Video Buffering End",VIDEO_EVENTS[VIDEO_FULLSCREEN]="Video Fullscreen",VIDEO_EVENTS[VIDEO_EXITFULLSCREEN]="Video Fullscreen Return";var VIDEO_NATIVE_ATTR_AUTOPLAY="autoplay",VIDEO_ID_ATTR_NAME="data-adtech-id",VIDEO_QUARTILE_POS_ATTR_NAME="data-adtech-quartile-position",VIDEO_TIME_ELAPSED_ATTR_NAME="data-adtech-time-elapsed",VIDEO_PAUSED="data-adtech-paused",VIDEO_MUTE_STATE_ATTR_NAME="data-adtech-mute-state",VIDEO_PLAYED_ONCE_ATTR_NAME="data-adtech-play-once",VIDEO_DISABLE_SEEK_ATTR_NAME="data-adtech-disable-seek-logging",VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME="data-adtech-disable-play-logging",VIDEO_DISABLE_AUTOPLAY_LOGGING_ATTR_NAME="data-adtech-disable-autoplay-logging",VIDEO_DISABLE_COMPLETE_LOGGING_ATTR_NAME="data-adtech-disable-complete-logging",VIDEO_BUFFERING_TIMER_ID="data-adtech-buffering-timer-id",VIDEO_BUFFERING="data-adtech-buffering",VIDEO_FULLSCREEN_STATE_ATTR_NAME="data-adtech-fullscreen",VIDEO_CHECK_BUFFERING_TIME=500,lastTrackedEvent={},VideoTracking={EVENT_NAMESPACE:"PCT",registerVideoPlayer:function(videoObject,reportingId){if(videoObject){videoObject.id&&(videoObject=videoObject.ownerDocument.getElementById(videoObject.id));var closure=com.adtech.Utils.createClosure,eventHandlerMap={play:closure(this,this.videoEventHandler),playButtonClick:closure(this,this.videoEventHandler),pause:closure(this,this.videoEventHandler),ended:closure(this,this.videoEventHandler),volumechange:closure(this,this.videoEventHandler),timeupdate:closure(this,this.videoEventHandler),seeked:closure(this,this.videoEventHandler),fullscreenchange:closure(this,this.videoEventHandler)};for(var eventName in eventHandlerMap)if(eventHandlerMap.hasOwnProperty(eventName)){var eventHandler=eventHandlerMap[eventName];com.adtech.Utils.removeNativeEventHandler(videoObject,eventName,eventHandler),com.adtech.Utils.registerNativeEventHandler(videoObject,eventName,eventHandler)}var videoId=reportingId?reportingId+" ":"";videoObject.setAttribute(VIDEO_ID_ATTR_NAME,videoId),lastTrackedEvent[videoId]={};try{videoObject.setAttribute(VIDEO_MUTE_STATE_ATTR_NAME,videoObject.muted.toString()),videoObject.setAttribute(VIDEO_FULLSCREEN_STATE_ATTR_NAME,videoObject.fullscreen.toString())}catch(e){}videoObject.setAttribute(VIDEO_QUARTILE_POS_ATTR_NAME,"1"),videoObject.setAttribute(VIDEO_PLAYED_ONCE_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_DISABLE_SEEK_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_DISABLE_COMPLETE_LOGGING_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_BUFFERING,"0"),""===videoObject.getAttribute(VIDEO_NATIVE_ATTR_AUTOPLAY)&&(videoObject.setAttribute(VIDEO_DISABLE_AUTOPLAY_LOGGING_ATTR_NAME,"0"),this.checkVideoPlayerStatus({target:videoObject}))}},videoEventHandler:function(event){var videoObject=event.target;switch(event.type){case"play":videoObject.setAttribute(VIDEO_DISABLE_SEEK_ATTR_NAME,"0"),videoObject.seeking||this.checkVideoPlayerStatus(event);break;case"playButtonClick":this.logVideoEvent(videoObject,"playButton");break;case"pause":if(lastTrackedEvent[videoObject.getAttribute(VIDEO_ID_ATTR_NAME)]=event,videoObject.duration-videoObject.currentTime<=1)return;videoObject.seeking||(videoObject.setAttribute(VIDEO_PAUSED,"1"),this.logVideoEvent(videoObject,event.type));break;case"seeked":if(lastTrackedEvent[videoObject.getAttribute(VIDEO_ID_ATTR_NAME)].timeStamp){var lastTimeStamp=lastTrackedEvent[videoObject.getAttribute(VIDEO_ID_ATTR_NAME)].timeStamp,timestampDifference=event.timeStamp-lastTimeStamp;videoObject.paused&&timestampDifference>1e3&&videoObject.setAttribute(VIDEO_DISABLE_SEEK_ATTR_NAME,"0")}else lastTrackedEvent[videoObject.getAttribute(VIDEO_ID_ATTR_NAME)]=event;videoObject.currentTime>.3?"1"!=videoObject.getAttribute(VIDEO_DISABLE_SEEK_ATTR_NAME)?(videoObject.setAttribute(VIDEO_DISABLE_SEEK_ATTR_NAME,"1"),this.logVideoEvent(videoObject,event.type)):(lastTrackedEvent[videoObject.getAttribute(VIDEO_ID_ATTR_NAME)].type==event.type&&!videoObject.paused&&timestampDifference>400&&this.logVideoEvent(videoObject,event.type),lastTrackedEvent[videoObject.getAttribute(VIDEO_ID_ATTR_NAME)]=event):this.checkVideoPlayerStatus(event),this.videoProgressEventHandler(event);break;case"ended":if(clearInterval(videoObject.getAttribute(VIDEO_BUFFERING_TIMER_ID)),"0"==videoObject.getAttribute(VIDEO_DISABLE_COMPLETE_LOGGING_ATTR_NAME)){for(var quartileIndex=parseInt(videoObject.getAttribute(VIDEO_QUARTILE_POS_ATTR_NAME))-1;quartileIndex<QUARTILE_LOGGING_ORDER.length;)this.logVideoEvent(videoObject,QUARTILE_LOGGING_ORDER[quartileIndex]),quartileIndex++;videoObject.setAttribute(VIDEO_QUARTILE_POS_ATTR_NAME,"4"),videoObject.setAttribute(VIDEO_DISABLE_COMPLETE_LOGGING_ATTR_NAME,"1"),videoObject.setAttribute(VIDEO_PLAYED_ONCE_ATTR_NAME,"1"),videoObject.setAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_TIME_ELAPSED_ATTR_NAME,"0"),this.logVideoEvent(videoObject,event.type)}break;case"volumechange":this.checkVideoVolumeStatus(event);case"timeupdate":this.videoProgressEventHandler(event);break;case"fullscreenchange":this.checkFullscreenStatus(event)}},checkVideoVolumeStatus:function(event){var videoObject=event.target;try{var mutedValue=videoObject.muted;videoObject.getAttribute(VIDEO_MUTE_STATE_ATTR_NAME)!=mutedValue.toString()&&(this.logVideoEvent(videoObject,mutedValue?VIDEO_MUTE:VIDEO_UNMUTE),videoObject.setAttribute(VIDEO_MUTE_STATE_ATTR_NAME,mutedValue.toString()))}catch(e){}},checkFullscreenStatus:function(event){var videoObject=event.target;try{var fullscreenValue=videoObject.fullscreen;videoObject.getAttribute(VIDEO_FULLSCREEN_STATE_ATTR_NAME)!=fullscreenValue.toString()&&(this.logVideoEvent(videoObject,fullscreenValue?VIDEO_FULLSCREEN:VIDEO_EXITFULLSCREEN),videoObject.setAttribute(VIDEO_FULLSCREEN_STATE_ATTR_NAME,fullscreenValue.toString()))}catch(e){}},checkVideoPlayerStatus:function(event){var videoObject=event.target;if(videoObject.currentTime<.3||"0"==videoObject.getAttribute(VIDEO_DISABLE_AUTOPLAY_LOGGING_ATTR_NAME)&&videoObject.currentTime>0){if("0"==videoObject.getAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME)){videoObject.setAttribute(VIDEO_DISABLE_AUTOPLAY_LOGGING_ATTR_NAME,"1"),"1"==videoObject.getAttribute(VIDEO_PLAYED_ONCE_ATTR_NAME)&&(this.logVideoEvent(videoObject,"replay"),videoObject.setAttribute(VIDEO_QUARTILE_POS_ATTR_NAME,"1"),videoObject.setAttribute(VIDEO_DISABLE_COMPLETE_LOGGING_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_TIME_ELAPSED_ATTR_NAME,"0"),videoObject.setAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME,"1"),this.logVideoEvent(videoObject,"play"));var previousTime=videoObject.currentTime,self=this,bufferingTimerId=setInterval(function(){"0"!=videoObject.getAttribute(VIDEO_BUFFERING)||videoObject.paused||previousTime!=videoObject.currentTime?(videoObject.paused&&"1"==videoObject.getAttribute(VIDEO_BUFFERING)||"1"==videoObject.getAttribute(VIDEO_BUFFERING)&&!videoObject.paused&&previousTime!=videoObject.currentTime)&&(videoObject.setAttribute(VIDEO_BUFFERING,"0"),self.logVideoEvent(videoObject,VIDEO_BUFFERING_END_EVENT)):(self.logVideoEvent(videoObject,VIDEO_BUFFERING_EVENT),videoObject.setAttribute(VIDEO_BUFFERING,"1")),previousTime=videoObject.currentTime},VIDEO_CHECK_BUFFERING_TIME);videoObject.setAttribute(VIDEO_BUFFERING_TIMER_ID,bufferingTimerId),this.logVideoPlayEvent(videoObject)}}else"1"==videoObject.getAttribute(VIDEO_PAUSED)&&(videoObject.setAttribute(VIDEO_PAUSED,"0"),this.logVideoEvent(videoObject,VIDEO_RESUME))},videoProgressEventHandler:function(event){var videoObject=event.target,videoDuration=Math.ceil(videoObject.duration),currentQuartile=videoObject.getAttribute(VIDEO_QUARTILE_POS_ATTR_NAME),storedTimeElapsed=parseInt(videoObject.getAttribute(VIDEO_TIME_ELAPSED_ATTR_NAME)),playheadPosition=Math.round(videoObject.currentTime);if(playheadPosition>0&&(videoObject.paused||videoObject.seeking||this.logVideoPlayEvent(videoObject)),isNaN(storedTimeElapsed)||playheadPosition>storedTimeElapsed){videoObject.setAttribute(VIDEO_TIME_ELAPSED_ATTR_NAME,playheadPosition);var quartileDelta=Math.round(videoDuration/4);playheadPosition>=1*quartileDelta&&"1"==currentQuartile&&(videoObject.setAttribute(VIDEO_QUARTILE_POS_ATTR_NAME,"2"),this.logVideoEvent(videoObject,VIDEO_FIRST_QUARTILE)),playheadPosition>=2*quartileDelta&&"2"==currentQuartile&&(videoObject.setAttribute(VIDEO_QUARTILE_POS_ATTR_NAME,"3"),this.logVideoEvent(videoObject,VIDEO_MIDPOINT)),playheadPosition>=3*quartileDelta&&"3"==currentQuartile&&(videoObject.setAttribute(VIDEO_QUARTILE_POS_ATTR_NAME,"4"),this.logVideoEvent(videoObject,VIDEO_THIRD_QUARTILE))}},logVideoPlayEvent:function(videoObject){"0"==videoObject.getAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME)&&"0"==videoObject.getAttribute(VIDEO_PLAYED_ONCE_ATTR_NAME)&&(videoObject.setAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME,"1"),this.logVideoEvent(videoObject,"play"))},logVideoEvent:function(videoObject,eventType){if(VIDEO_EVENTS[eventType]){var videoId=videoObject.getAttribute(VIDEO_ID_ATTR_NAME),reportingString=videoId+VIDEO_EVENTS[eventType];ADTECH.event(reportingString);var eventName=VideoTracking.EVENT_NAMESPACE+"."+VIDEO_EVENTS[eventType];try{var videoObjectEvent=new Event(eventName)}catch(err){videoObjectEvent=document.createEvent("Event"),videoObjectEvent.initEvent(eventName,!0,!1)}videoObject.dispatchEvent(videoObjectEvent)}},setReportingId:function(videoObject,reportingId){var videoId=reportingId?reportingId+" ":"";"0"==videoObject.getAttribute(VIDEO_DISABLE_PLAY_LOGGING_ATTR_NAME)&&videoObject.setAttribute(VIDEO_ID_ATTR_NAME,videoId)}};return ADTECH.modules=ADTECH.modules||{},ADTECH.modules.VideoTracking=VideoTracking,VideoTracking});